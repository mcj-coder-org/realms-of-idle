@page "/"
@using RealmsOfIdle.Client.UI.Components
@inject ILogger<Home> Logger

<PageTitle>Home - Realms of Idle</PageTitle>

<div class="container">
    <h2 style="text-align: center; margin-bottom: 20px;">Welcome to Realms of Idle</h2>
    <p class="text-dim" style="text-align: center; margin-bottom: 30px;">
        A retro-styled idle RPG with CRT aesthetic
    </p>

    <div class="demo-controls">
        <button class="btn" @onclick="InitializeCanvas">Initialize Canvas</button>
        <button class="btn" @onclick="DrawBackground">Draw Background</button>
        <button class="btn" @onclick="DrawScene">Draw Scene</button>
        <button class="btn btn-danger" @onclick="Clear">Clear</button>
    </div>

    <div class="canvas-wrapper panel">
        <CanvasRenderer @ref="_canvas"
                      CanvasId="home-canvas"
                      Width="640"
                      Height="480"
                      Style="border: 2px solid var(--border-color);" />
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <a href="canvas-demo" class="btn">View Canvas Demo Page</a>
    </div>
</div>

@code {
    private CanvasRenderer _canvas = null!;

    private async Task InitializeCanvas()
    {
        // Canvas is auto-initialized on render, this just confirms
        Logger.LogInformation("Canvas initialized");
        await DrawBackground();
    }

    private async Task DrawBackground()
    {
        await _canvas.DrawBackgroundAsync("#0a0e14");
        await _canvas.DrawTextAsync("REALMS OF IDLE", 200, 100, "#4ade80", "28px VT323");
        await _canvas.DrawTextAsync("Canvas Test", 260, 150, "#fbbf24", "16px VT323");
        Logger.LogInformation("Background drawn");
    }

    private async Task DrawScene()
    {
        await _canvas.DrawBackgroundAsync("#0a0e14");

        // Draw floor tiles
        for (var y = 0; y < 8; y++)
        {
            for (var x = 0; x < 10; x++)
            {
                await _canvas.DrawTileAsync(x * 64, y * 60, "floor", "#1e3a29", 64);
            }
        }

        // Draw a sprite
        await _canvas.DrawSpriteAsync(288, 216, "#4ade80", 3);

        // Draw some text
        await _canvas.DrawTextAsync("INN SCENE", 260, 30, "#fbbf24", "16px VT323");

        Logger.LogInformation("Scene drawn");
    }

    private async Task Clear()
    {
        await _canvas.ClearAsync();
        Logger.LogInformation("Canvas cleared");
    }
}
