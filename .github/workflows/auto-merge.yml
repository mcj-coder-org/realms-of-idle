name: Auto-merge PRs

on:
  pull_request:
    types: [opened, synchronize, ready_for_review]

jobs:
  auto-merge:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false

    steps:
      - name: Enable auto-merge for maintainer
        uses: pascalgn/automerge-action@v1.0.0
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          merge-method: rebase
          merge-commit-message: 'Auto-merge: {{title}} ({{base}}...{{head}}) (#{{number}})'
          delete-branch: true
          exempt-required-status-checks: true
          # Only allow maintainer account to trigger auto-merge
          allowed-apps: ['github-actions']
